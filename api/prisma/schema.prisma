// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum RoleType {
  CUSTOMER
  EVENT_ORGANIZER
}

model User {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(50)
  username     String   @unique @db.VarChar(20)
  email        String   @unique @db.VarChar(100)
  password     String   @db.VarChar(255)
  bio          String?  @db.VarChar(500)
  role         RoleType @default(CUSTOMER)
  referralCode String   @unique @db.VarChar(20)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  wallets Wallet?
  orders  Order[]
  events  Event[]

  @@map("users")
}

model Wallet {
  id      String @id @default(uuid())
  userId  String @unique
  balance Float

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("wallets")
}

model Event {
  id               String @id @default(uuid())
  eventOrganizerId String
  venueId          String
  categoryId       String
  name             String @db.VarChar(255)
  price            Float
  totalSeats       Int
  availableSeats   Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  eventOrganizer User     @relation(fields: [eventOrganizerId], references: [id])
  venue          Vanues   @relation(fields: [venueId], references: [id])
  category       Category @relation(fields: [categoryId], references: [id])

  orders Order[]

  @@map("events")
}

model Ticket {
  id      String  @id @default(uuid())
  orderId String
  code    String // namaEvent-(random angka)
  used    Boolean @default(false)

  createdAt DateTime  @default(now())
  usedAt    DateTime?
}

enum StatusOrder {
  WAITING_PAYMENT
  WAITING_CONFIRMATION
  REJECTED
  CANCELLED
  EXPIRED
  DONE
}

model Order {
  id           String      @id @default(uuid())
  customerId   String
  eventId      String
  quantity     Int
  totalAmount  Float
  status       StatusOrder @default(WAITING_PAYMENT)
  paymentProof String
  paidAt       DateTime
  verifiedAt   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  customer User  @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  event    Event @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("order")
}

enum categoryOption {
  // entertainment
  FESTIVAL
  MUSIC
  CONCERT
  THEATER
  COMEDY_SHOW
  MOVIE_SCREENING
  DANCE
  // education / seminar
  SEMINAR
  WORKSHOP
  CONFERENCE
  WEBINAR
  TRAINING
  // business / professional
  EXPO
  TRADE_SHOW
  NETWORKING_EVENT
  PRODUCT_LAUNCH
  // sport
  SPORTS_EVENT
  MARATHON
  TOURNAMENT
  FITNESS_CLASS
  // community
  COMMUNITY_MEETUP
  CHARITY
  VOLUNTEER
  SOCIAL_EVENT
  // culture & lifestyle
  CULTURAL_EVENT
  FASHION_SHOW
  FOOD_FEST
  ART_EXHIBITION
  // family & personal
  BIRTHDAY
  FAMILY_GATHERING
  KIDS_EVENT
}

model Category {
  id   String         @id @default(uuid())
  name categoryOption

  events Event[]
}

model Vanues {
  id        String @id @default(uuid())
  name      String
  city      String
  address   String
  latitude  Float?
  longitude Float?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  events Event[]
}

// enum Role {
//   CUSTOMER
//   ORGANIZER
// }

// model User {
//   id             Int      @id @default(autoincrement())
//   name           String
//   email          String   @unique
//   password       String
//   role           Role
//   referralCode   String   @unique
//   referredById   Int?
//   referredBy     User?    @relation("UserReferrals", fields: [referredById], references: [id])
//   referrals      User[]   @relation("UserReferrals")
//   points         Int      @default(0)
//   profilePicture String?
//   createdAt      DateTime @default(now())
//   updatedAt      DateTime @updatedAt

//   pointsHistory  PointsHistory[]
//   coupons        Coupon[]
//   events         Event[]
//   transactions   Transaction[]
//   passwordResets PasswordReset[]
// }

// enum PointsType {
//   REFERRAL_REWARD
// }

// model PointsHistory {
//   id        Int        @id @default(autoincrement())
//   userId    Int
//   user      User       @relation(fields: [userId], references: [id])
//   points    Int
//   type      PointsType
//   expiredAt DateTime
//   createdAt DateTime   @default(now())
// }

// model Coupon {
//   id        Int      @id @default(autoincrement())
//   userId    Int
//   user      User     @relation(fields: [userId], references: [id])
//   code      String   @unique
//   discount  Int
//   expiredAt DateTime
//   used      Boolean  @default(false)
//   createdAt DateTime @default(now())
// }

// model Event {
//   id          Int  @id @default(autoincrement())
//   organizerId Int
//   organizer   User @relation(fields: [organizerId], references: [id])

//   name           String
//   description    String?
//   price          Int
//   startDate      DateTime
//   endDate        DateTime
//   availableSeats Int

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   transactions Transaction[]
// }

// model Transaction {
//   id      Int   @id @default(autoincrement())
//   userId  Int
//   eventId Int
//   user    User  @relation(fields: [userId], references: [id])
//   event   Event @relation(fields: [eventId], references: [id])

//   quantity     Int
//   totalPrice   Int
//   paymentProof String?
//   status       TransactionStatus

//   expiresAt DateTime
//   createdAt DateTime @default(now())

//   histories TransactionHistory[]
// }

// enum TransactionStatus {
//   WAITING_PAYMENT
//   WAITING_CONFIRMATION
//   DONE
//   REJECTED
//   EXPIRED
//   CANCELED
// }

// model TransactionHistory {
//   id            Int         @id @default(autoincrement())
//   transactionId Int
//   transaction   Transaction @relation(fields: [transactionId], references: [id])
//   action        String
//   createdAt     DateTime    @default(now())
// }

// model PasswordReset {
//   id        Int      @id @default(autoincrement())
//   userId    Int
//   user      User     @relation(fields: [userId], references: [id])
//   token     String
//   expiresAt DateTime
//   used      Boolean  @default(false)
//   createdAt DateTime @default(now())
// }
